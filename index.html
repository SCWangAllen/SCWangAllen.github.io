<!DOCTYPE html><html lang="zh-TW"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="Record my learning process"><meta name="keywords" content=""><meta name="author" content="Shan Chi Wang (Allen)"><meta name="copyright" content="Shan Chi Wang (Allen)"><title>My tech blog | SCWangAllen</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.9.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.1"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css?version=1.9.1"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  hexoVersion: '6.3.0'
} </script><meta name="generator" content="Hexo 6.3.0"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="false"><div class="author-info"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">Shan Chi Wang (Allen)</div><div class="author-info__description text-center">Record my learning process</div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">4</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">3</span></a></div></div></div><nav class="no-bg" id="nav"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">SCWangAllen</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/About">About</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span><span class="pull-right"></span></div><div id="site-info"><div id="site-title">SCWangAllen</div><div id="site-sub-title">My tech blog</div><div id="site-social-icons"><a class="social-icon" href="https://medium.com/@powerful_lapis_impala_871" target="_blank" rel="noreferrer noopener nofollow"><i class="fa-medium fab"></i></a><a class="social-icon" href="https://github.com/SCWangAllen" target="_blank" rel="noreferrer noopener nofollow"><i class="fa-github fab"></i></a></div></div></nav><div id="content-outer"><div class="layout" id="content-inner"><div class="recent-post-item article-container"><a class="article-title" href="/2023/Use-Notion-and-Python-to-build-my-own-vocabulary-database-%E2%80%94-3-Notion-API/">Use Notion and Python to build my own vocabulary database — (3)[Notion API]</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2023-07-01</time><div class="content"><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>在之前的系列文章中，我們已成功利用爬蟲技術獲取了各種有價值的資料。這些資料對我們來說是寶貴的資源，但僅僅擁有這些資料並不足夠，我們需要一個強大的工具來組織、管理和利用這些資料。在這篇文章中，我們將介紹如何使用Notion API，將我們取得的資料與Notion串接，建立起我們自己的詞彙庫資料庫。通過這種方式，我們可以更有效地組織和存取我們的資料，並將其轉化為有價值的知識和資源。讓我們一起開始學習如何利用Notion和Python打造屬於我們自己的詞彙庫資料庫吧！</p>
<h1 id="過程"><a href="#過程" class="headerlink" title="過程"></a>過程</h1><p>Notion是一個功能強大的協作工具，幾乎擁有無限的擴展性和自定義性。它提供了一個方便的JavaScript版本API，使開發者能夠透過request來實現幾乎所有的功能。但考慮到我們將在Django伺服器上架設，我選擇使用Python API。在這個過程中，我遇到了一些挑戰和困難，但我成功地克服了它們，並找到了解決方案。</p>
<p>在本文中，我將詳細介紹我在使用Notion API過程中所遇到的問題和解決方法。我將分享我遇到的坑，並提供實用的技巧，以幫助讀者順利使用Notion API並在Django伺服器上建立自己的詞彙庫資料庫。(<a target="_blank" rel="noopener" href="https://developers.notion.com/">Notion API文件網址</a>)</p>
<h1 id="Four-Steps"><a href="#Four-Steps" class="headerlink" title="Four Steps"></a>Four Steps</h1><p>要使用notion API更新database有下列四個步驟。</p>
<ol>
<li>建立integration</li>
<li>database要和integration建立連結</li>
<li>取得database的id</li>
<li>更新資料進database</li>
</ol>
<p>要特別注意的是第四部，範例如下，要注意是database的ID，如果是一頁裡面包含一個database要注意不要拿錯拿到那個page的ID。</p>
<p><img src="https://miro.medium.com/v2/resize:fit:700/0*j4ny8Xp5mxsuv71d.png"></p>
<p>fig1:database ID example</p>
<h1 id="Build-Integration"><a href="#Build-Integration" class="headerlink" title="Build Integration"></a>Build Integration</h1><p>到<a target="_blank" rel="noopener" href="https://www.notion.so/my-integrations">My integrations | Notion Developers</a>此網址能夠看到自己的integration，點擊新增integration會到以下介面，要注意workspace是你的database在的地方。</p>
<p><img src="https://miro.medium.com/v2/resize:fit:700/1*L6X2PMcKg-2qOsBNgt_T8g.png"></p>
<p>fig2:Create integration</p>
<p><img src="https://miro.medium.com/v2/resize:fit:700/1*GhxfNdoc7XmW7SaQLpFIVA.png"></p>
<p>fig3: Secret key</p>
<p>要注意上面得key，就是我們接下來要使用的連接notion的key，可以將他存到環境變數裡。</p>
<h1 id="Connect-Integration-and-database"><a href="#Connect-Integration-and-database" class="headerlink" title="Connect Integration and database"></a>Connect Integration and database</h1><p>database頁面右手邊的設定能夠找到 add connections這選項，若integration新增成功，你會找到你剛剛新增的integration。</p>
<p><img src="https://miro.medium.com/v2/resize:fit:245/1*8NndeXb8NJcIlPpQWPletw.png"></p>
<p>fig4: conneciton</p>
<h1 id="Add-page-into-database"><a href="#Add-page-into-database" class="headerlink" title="Add page into database"></a>Add page into database</h1><p>接下來就是重頭戲中的重頭戲，我們必須將資料輸入進去database，而再將資料匯入的時候，我們必需特別注意一件Notion API的限制。我再這個案例中遇到的限制有以下兩個。</p>
<ol>
<li>rich_text：1000token limits</li>
<li>blocks ：一次只能100個</li>
</ol>
<p>之所以會遇到第一個的問題，是因為一開始，我會想要直接將全部資料一次丟進去，就會導致超出限制，而第二個問題是，當我切割每一塊為不同的block的時候，遇到單字他的block數過多導致更新失敗，最終結果如下，針對block的更新，我是採用一個一個block,append到blocks這個list裡面的方式。(<a target="_blank" rel="noopener" href="https://developers.notion.com/reference/intro">NOTION API文件</a>)</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> notion_client <span class="keyword">import</span> Client  </span><br><span class="line">vocabulary_token = os.getenv(<span class="string">&quot;NOTION_KEY&quot;</span>)  </span><br><span class="line">notion = Client(auth=vocabulary_token)  </span><br><span class="line">page = notion.pages.create(  </span><br><span class="line">    parent=&#123;<span class="string">&quot;database_id&quot;</span>: <span class="string">&#x27;your_id&#x27;</span>&#125;,<span class="comment">#請改成database的ID  </span></span><br><span class="line">    properties=&#123;  </span><br><span class="line">        <span class="string">&quot;keyword&quot;</span>: &#123;<span class="string">&quot;title&quot;</span>: [&#123;<span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>, <span class="string">&quot;text&quot;</span>: &#123;<span class="string">&quot;content&quot;</span>: title&#125;&#125;]&#125;,<span class="comment">#page的屬性  </span></span><br><span class="line">        <span class="string">&quot;tag&quot;</span>: &#123;<span class="string">&quot;type&quot;</span>: <span class="string">&quot;multi_select&quot;</span>, <span class="string">&quot;multi_select&quot;</span>: [&#123;<span class="string">&quot;name&quot;</span>: tag&#125;]&#125;,  </span><br><span class="line">         <span class="string">&quot;url&quot;</span>: &#123;<span class="string">&quot;rich_text&quot;</span>: [&#123;<span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>, <span class="string">&quot;text&quot;</span>:   </span><br><span class="line">                                &#123;<span class="string">&quot;content&quot;</span>: url,  </span><br><span class="line">                                 <span class="string">&#x27;link&#x27;</span>:&#123;<span class="string">&#x27;url&#x27;</span>:url_for_link&#125;  </span><br><span class="line">                                 &#125;  </span><br><span class="line">                                &#125;]&#125;,  </span><br><span class="line">        <span class="string">&quot;meaning&quot;</span>: &#123;<span class="string">&quot;rich_text&quot;</span>: [&#123;<span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>, <span class="string">&quot;text&quot;</span>: &#123;<span class="string">&quot;content&quot;</span>: word_info[<span class="number">0</span>][<span class="string">&#x27;translation&#x27;</span>]&#125;&#125;]&#125;  </span><br><span class="line">  </span><br><span class="line">    &#125;,  </span><br><span class="line">    children=blocks,  </span><br><span class="line">    icon=&#123;<span class="string">&quot;type&quot;</span>: <span class="string">&quot;emoji&quot;</span>, <span class="string">&quot;emoji&quot;</span>: <span class="string">&quot;📚&quot;</span>&#125;  </span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">blocks = []  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">for</span> definition <span class="keyword">in</span> word_info:  </span><br><span class="line">    definition_block = &#123;  </span><br><span class="line">        <span class="string">&quot;object&quot;</span>: <span class="string">&quot;block&quot;</span>,  </span><br><span class="line">        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;heading_2&quot;</span>,  </span><br><span class="line">        <span class="string">&quot;heading_2&quot;</span>: &#123;  </span><br><span class="line">            <span class="string">&quot;rich_text&quot;</span>: [  </span><br><span class="line">                &#123;  </span><br><span class="line">                    <span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,  </span><br><span class="line">                    <span class="string">&quot;text&quot;</span>: &#123;<span class="string">&quot;content&quot;</span>: <span class="string">&quot;Definition:&quot;</span>, <span class="string">&quot;link&quot;</span>: <span class="literal">None</span>&#125;  </span><br><span class="line">                &#125;  </span><br><span class="line">            ],  </span><br><span class="line">            <span class="string">&quot;color&quot;</span>:<span class="string">&quot;blue_background&quot;</span>,  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">    blocks.append(definition_block)  </span><br><span class="line">  </span><br><span class="line">    definition_text = &#123;  </span><br><span class="line">        <span class="string">&quot;object&quot;</span>: <span class="string">&quot;block&quot;</span>,  </span><br><span class="line">        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;paragraph&quot;</span>,  </span><br><span class="line">        <span class="string">&quot;paragraph&quot;</span>: &#123;  </span><br><span class="line">            <span class="string">&quot;rich_text&quot;</span>: [  </span><br><span class="line">                &#123;  </span><br><span class="line">                    <span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,  </span><br><span class="line">                    <span class="string">&quot;text&quot;</span>: &#123;<span class="string">&quot;content&quot;</span>: definition[<span class="string">&#x27;definition&#x27;</span>], <span class="string">&quot;link&quot;</span>: <span class="literal">None</span>&#125;  </span><br><span class="line">                &#125;  </span><br><span class="line">            ],  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">    blocks.append(definition_text)  </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>要注意裡面他需要的格式通常都是dict，我們可以結合其他資料結構去做正規化的處理，讓更新有韌性。</p>
<h1 id="Update-page"><a href="#Update-page" class="headerlink" title="Update page"></a>Update page</h1><p>我的需求中，我會想要把我看到這個單字的網站在那邊給記錄下來，因此我要確認，這個單字是否在database裡面已經存在，所以我又另外寫了三個funciton。</p>
<h1 id="找出相關單字的page"><a href="#找出相關單字的page" class="headerlink" title="找出相關單字的page"></a>找出相關單字的page</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">filter_pages_by_keyword</span>(<span class="params">keyword: <span class="built_in">str</span></span>):  </span><br><span class="line">    <span class="comment"># 创建一个过滤条件，根据&quot;keyword&quot;属性的值进行过滤  </span></span><br><span class="line">    filter_condition = &#123;  </span><br><span class="line">    <span class="string">&quot;and&quot;</span>: [  </span><br><span class="line">        &#123;  </span><br><span class="line">            <span class="string">&quot;property&quot;</span>: <span class="string">&quot;keyword&quot;</span>,  </span><br><span class="line">            <span class="string">&quot;title&quot;</span>: &#123;  </span><br><span class="line">                <span class="string">&quot;equals&quot;</span>: keyword  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;,  </span><br><span class="line">    ]  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment"># 使用过滤条件来查询数据库  </span></span><br><span class="line">    response = notion.databases.query(  </span><br><span class="line">        database_id=<span class="string">&#x27;9ed5b492835e40eb93cc72d38edc3fc7&#x27;</span>,  </span><br><span class="line">        <span class="built_in">filter</span>=filter_condition  </span><br><span class="line">    )  </span><br><span class="line">  </span><br><span class="line">    <span class="comment"># 返回查询结果  </span></span><br><span class="line">    <span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line"><span class="comment"># 更新裡面的url屬性，且要有連結  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add_url_to_page</span>(<span class="params">page_id: <span class="built_in">str</span>, new_url: <span class="built_in">str</span></span>):  </span><br><span class="line">    <span class="comment"># 取得filter過後頁面的資料  </span></span><br><span class="line">    page = notion.pages.retrieve(page_id=page_id)  </span><br><span class="line">  </span><br><span class="line">    <span class="comment"># 取得這個page url的相關資料  </span></span><br><span class="line">    current_url_content = page[<span class="string">&#x27;properties&#x27;</span>][<span class="string">&#x27;url&#x27;</span>][<span class="string">&#x27;rich_text&#x27;</span>]  </span><br><span class="line">  </span><br><span class="line">    <span class="comment"># 在原本的content後面加上  </span></span><br><span class="line">    new_url_content = current_url_content + [&#123;  </span><br><span class="line">        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,  </span><br><span class="line">        <span class="string">&quot;text&quot;</span>: &#123;  </span><br><span class="line">            <span class="string">&quot;content&quot;</span>: <span class="string">&quot;  ,  &quot;</span> ,  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;]  </span><br><span class="line">    <span class="keyword">if</span> is_valid_url(new_url):  </span><br><span class="line">        new_url_for_link=new_url  </span><br><span class="line">    <span class="keyword">else</span>:  </span><br><span class="line">        new_url_for_link=<span class="string">&#x27;http://example.com&#x27;</span>  </span><br><span class="line">    new_url_content = new_url_content + [&#123;  </span><br><span class="line">        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,  </span><br><span class="line">        <span class="string">&quot;text&quot;</span>: &#123;  </span><br><span class="line">            <span class="string">&quot;content&quot;</span>:  new_url,  </span><br><span class="line">            <span class="string">&quot;link&quot;</span>: &#123;  </span><br><span class="line">                <span class="string">&quot;url&quot;</span>: new_url_for_link  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;]  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">    <span class="comment"># 更新页面的 &quot;url&quot; 属性  </span></span><br><span class="line">    updated_page = notion.pages.update(  </span><br><span class="line">        page_id=page_id,  </span><br><span class="line">        properties=&#123;  </span><br><span class="line">            <span class="string">&quot;url&quot;</span>: &#123;  </span><br><span class="line">                <span class="string">&quot;rich_text&quot;</span>: new_url_content  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">    )  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">return</span> updated_page</span><br><span class="line"></span><br><span class="line"><span class="comment"># 結合上面的程式，當有一個單字進還，會先確認是否有此單字，再做insert的動作  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">filter_or_insert</span>(<span class="params">keyword: <span class="built_in">str</span>, word_info, title: <span class="built_in">str</span> = <span class="string">&#x27;&#x27;</span>, tag: <span class="built_in">str</span> = <span class="string">&quot;TBD&quot;</span>, url: <span class="built_in">str</span>=<span class="string">&#x27;http://example.com&#x27;</span></span>):  </span><br><span class="line">    <span class="comment"># 首先，尝试根据关键词查找页面  </span></span><br><span class="line">    response = filter_pages_by_keyword(keyword)  </span><br><span class="line">  </span><br><span class="line">    <span class="comment"># 如果找不到任何页面，那么插入一个新的页面  </span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> response[<span class="string">&#x27;results&#x27;</span>]:  </span><br><span class="line">        insert_to_notion(word_info, title, tag, url)  </span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;Insertion successful&quot;</span>, <span class="string">&quot;success&quot;</span>: <span class="literal">True</span>&#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment"># 如果找到了页面，那么更新这些页面的 URL  </span></span><br><span class="line">    <span class="keyword">for</span> page <span class="keyword">in</span> response[<span class="string">&#x27;results&#x27;</span>]:  </span><br><span class="line">        add_url_to_page(page[<span class="string">&#x27;id&#x27;</span>], url)  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;Page(s) updated&quot;</span>, <span class="string">&quot;success&quot;</span>: <span class="literal">True</span>&#125;</span><br></pre></td></tr></table></figure>

<h1 id="結語"><a href="#結語" class="headerlink" title="結語"></a>結語</h1><p>在這篇文章中，我們學習了如何使用Notion API和Python來建立自己的詞彙庫資料庫。我們使用爬蟲技術獲取了有價值的資料，並將其與Notion的功能結合起來。通過建立integration、連接database、將資料插入database並更新頁面，我們成功地建立了一個具有強大功能和彈性的詞彙庫資料庫，後續我將把這些功能結合在Django上，讓他可以變成一個server端的功能。</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2023/Use-Notion-and-Python-to-build-my-own-vocabulary-database-%E2%80%94-2-Web-crawler/">Use Notion and Python to build my own vocabulary database — (2)[Web crawler]</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2023-07-01</time><div class="content"><h1 id="取得有效的資料源"><a href="#取得有效的資料源" class="headerlink" title="取得有效的資料源"></a>取得有效的資料源</h1><p>要建立單字的資料庫，首先我們必須保證資料的正確性，一開始我考慮去串接知名的英語辭典API，結果發現這些API或多或少都需要花錢，且劍橋英語的API更是一個月需要30美元的價格，這對一個每個月使用量不會太多的我來說，實在是有點誇張了，因此我想了另一個辦法，那就是使用爬蟲來取得我想要的資料，順便複習一下。</p>
<h1 id="如何爬蟲"><a href="#如何爬蟲" class="headerlink" title="如何爬蟲"></a>如何爬蟲</h1><p>所謂網路爬蟲，只是讓程式去模擬瀏覽器的行為，並取得我們想要的資料的一個動作而已，然而我們要有效且快速的去取得想要的資料，那對於Html的瞭解也是必備。而我使用的程式語言是python搭配selenium去做爬蟲，以下我會一步一步的描述如何取得相關資料。</p>
<h1 id="Selenium"><a href="#Selenium" class="headerlink" title="Selenium"></a>Selenium</h1><p>selenium是一個python套件，讓我們能夠使用driver去模擬瀏覽器去做操作，可以做動態的爬蟲，相當方便，他剛好也符合我接下來的需求，因為我必需去模擬網站做搜尋的動作。(<a target="_blank" rel="noopener" href="https://www.selenium.dev/documentation/">Selenium Document</a>)</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver  </span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.by <span class="keyword">import</span> By  </span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support.wait <span class="keyword">import</span> WebDriverWait  </span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support <span class="keyword">import</span> expected_conditions <span class="keyword">as</span> EC  </span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.chrome.options <span class="keyword">import</span> Options  </span><br><span class="line">chrome_options = Options()  </span><br><span class="line">chrome_options.add_argument(<span class="string">&quot;--headless&quot;</span>)  </span><br><span class="line">driver = webdriver.Chrome(options=chrome_options)  </span><br><span class="line">  </span><br><span class="line">url = <span class="string">&#x27;https://dictionary.cambridge.org/zht/&#x27;</span> <span class="comment">#中文網站  </span></span><br><span class="line">driver.get(url)  </span><br><span class="line">  </span><br><span class="line">search_box = driver.find_element(By.NAME, <span class="string">&#x27;q&#x27;</span>)  </span><br><span class="line">search_box.send_keys(word)  </span><br><span class="line">search_box.submit()  </span><br><span class="line">  </span><br><span class="line">wait = WebDriverWait(driver, <span class="number">2</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p>上面是如何去開啟一個driver去請求網站，下面我們就必需去觀察一下網站的html，我們可以觀察到，他的網站區塊明顯解釋、中文、例句、中文的排序去做的，因此我們也能夠想像到他在html中的排序也應該如此。</p>
<p><img src="https://miro.medium.com/v2/resize:fit:700/1*f4S-L8hKcymIQS4qnwjkKQ.png"></p>
<p>fig1:網站畫面</p>
<p>再觀察了相關的網站架構之後，我經過嘗試以及優化，撰寫了以下的取得資料的方式。</p>
<h1 id="做例外處裡，因為有些單字查不到的話是不會有def-block-ddef-block這一塊的"><a href="#做例外處裡，因為有些單字查不到的話是不會有def-block-ddef-block這一塊的" class="headerlink" title="做例外處裡，因為有些單字查不到的話是不會有def-block.ddef_block這一塊的"></a>做例外處裡，因為有些單字查不到的話是不會有def-block.ddef_block這一塊的</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span>:  </span><br><span class="line">    element = wait.until(EC.presence_of_element_located(  </span><br><span class="line">        (By.CLASS_NAME, <span class="string">&#x27;def-block.ddef_block&#x27;</span>)))  </span><br><span class="line"><span class="keyword">except</span>:  </span><br><span class="line">    driver.quit()  </span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&#x27;definition&#x27;</span>: <span class="string">&#x27;無此單字&#x27;</span>, <span class="string">&#x27;translation&#x27;</span>: <span class="string">&#x27;無此單字&#x27;</span>, <span class="string">&#x27;examples&#x27;</span>: []&#125;  </span><br><span class="line">word_element = driver.find_element(By.CSS_SELECTOR, <span class="string">&#x27;.headword.dhw.dpos-h_hw&#x27;</span>).text  </span><br><span class="line">def_blocks = driver.find_elements(By.CSS_SELECTOR, <span class="string">&#x27;.def-block.ddef_block&#x27;</span>) </span><br><span class="line"></span><br><span class="line"><span class="comment">#因為他是一塊一塊的，所以要用for迴圈把他們一個一個抓出來  </span></span><br><span class="line">definitions = []  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">for</span> i, block <span class="keyword">in</span> <span class="built_in">enumerate</span>(def_blocks):  </span><br><span class="line">    <span class="comment"># 提取英文定義  </span></span><br><span class="line">    def_text = block.find_element(By.CSS_SELECTOR, <span class="string">&#x27;.def.ddef_d.db&#x27;</span>).text  </span><br><span class="line">  </span><br><span class="line">    <span class="comment"># 提取中文翻譯  </span></span><br><span class="line">    trans_text = block.find_element(  </span><br><span class="line">        By.CSS_SELECTOR, <span class="string">&#x27;.trans.dtrans.dtrans-se.break-cj&#x27;</span>).text  </span><br><span class="line">  </span><br><span class="line">    <span class="comment"># 提取英文例句  </span></span><br><span class="line">    eng_examples = block.find_elements(  </span><br><span class="line">        By.CSS_SELECTOR, <span class="string">&#x27;.examp.dexamp .eg.deg&#x27;</span>)  </span><br><span class="line">  </span><br><span class="line">    <span class="comment"># 提取中文例句  </span></span><br><span class="line">    chi_examples = block.find_elements(  </span><br><span class="line">        By.CSS_SELECTOR, <span class="string">&#x27;.examp.dexamp .trans.dtrans.dtrans-se.hdb.break-cj&#x27;</span>)  </span><br><span class="line">  </span><br><span class="line">    <span class="comment"># 使用zip函數將英文例句和中文例句配對起來  </span></span><br><span class="line">    examples = [(eng.text, chi.text)  </span><br><span class="line">                <span class="keyword">for</span> eng, chi <span class="keyword">in</span> <span class="built_in">zip</span>(eng_examples, chi_examples)]  </span><br><span class="line">  </span><br><span class="line">    definitions.append(&#123;  </span><br><span class="line">        <span class="string">&#x27;definition&#x27;</span>: def_text,  </span><br><span class="line">        <span class="string">&#x27;translation&#x27;</span>: trans_text,  </span><br><span class="line">        <span class="string">&#x27;examples&#x27;</span>: examples,  </span><br><span class="line">    &#125;)  </span><br><span class="line">  </span><br><span class="line">driver.quit()</span><br></pre></td></tr></table></figure>

<p>最後會輸出一個list，裡面的元素都是以每個block的資料所組成，example的部分，由於會有多個example，因此Example是一個list，而這邊的資料型態組合要特別注意，因為之後在接Notion API的時候，是什麼型態會影響我們要如何去接。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[&#123;<span class="string">&#x27;definition&#x27;</span>: <span class="string">&#x27;the fact of reaching, stretching, or continuing; the act of adding to something in order to make it bigger or longer&#x27;</span>,  </span><br><span class="line"> <span class="string">&#x27;translation&#x27;</span>: <span class="string">&#x27;伸展；延伸&#x27;</span>,   </span><br><span class="line"><span class="string">&#x27;examples&#x27;</span>: [(<span class="string">&#x27;Martin Luther King, Jr, campaigned for the extension of civil rights to (= for them to include) black people.&#x27;</span>, <span class="string">&#x27;小馬丁‧路德‧金發起了為黑人爭取公民權利的運動。&#x27;</span>), (<span class="string">&#x27;The extension (= increasing) of police powers in the province has been heavily criticized.&#x27;</span>, <span class="string">&#x27;在該省增加警力的做法遭到嚴厲的抨擊。&#x27;</span>), (<span class="string">&#x27;His report contained serious criticisms of the finance director, and, by extension (= therefore), of the entire board of management.&#x27;</span>, <span class="string">&#x27;他的報告對財務總監進行了嚴厲批評，進而又擴及到整個管理委員會。&#x27;</span>), (<span class="string">&#x27;The article is an extension of (= takes further) the ideas Professor Fox developed in an earlier book.&#x27;</span>, <span class="string">&#x27;這篇文章進一步伸展了福克斯教授在先前出版的著作中闡述的觀點。&#x27;</span>), (<span class="string">&quot;I&#x27;ve applied for an extension to my visa (= asked for it to last longer).&quot;</span>, <span class="string">&#x27;我已經申請將簽證延期。&#x27;</span>), (<span class="string">&#x27;They are hoping to get an extension of their loan (= to be given a longer period of time in which to pay it back).&#x27;</span>, <span class="string">&#x27;他們希望能夠將貸款期限延長。&#x27;</span>)]&#125;,  </span><br><span class="line"> &#123;<span class="string">&#x27;definition&#x27;</span>: <span class="string">&#x27;any of two or more phones in the same house that share the same number, or any of a number of phones connected to a switchboard in a large building such as an office&#x27;</span>,  </span><br><span class="line"> <span class="string">&#x27;translation&#x27;</span>: <span class="string">&#x27;（共用一個號碼的）電話分機；（號碼不同的）電話分機&#x27;</span>,  </span><br><span class="line"> <span class="string">&#x27;examples&#x27;</span>: [(<span class="string">&#x27;We have an extension in our bedroom.&#x27;</span>, <span class="string">&#x27;我們在臥室裝了一部分機。&#x27;</span>), (<span class="string">&#x27;When you call, ask for extension 3276.&#x27;</span>, <span class="string">&#x27;當你打電話時，請總機轉入分機3276。&#x27;</span>)]&#125;,   </span><br><span class="line">&#123;<span class="string">&#x27;definition&#x27;</span>: <span class="string">&#x27;the last part of the name of a computer file, which comes after a (.) and shows what type of file it is&#x27;</span>,   </span><br><span class="line"><span class="string">&#x27;translation&#x27;</span>: <span class="string">&#x27;副檔名（電腦檔案名稱的最後一部分，用於區分檔案種類）&#x27;</span>,   </span><br><span class="line"><span class="string">&#x27;examples&#x27;</span>: []&#125;,   </span><br><span class="line">&#123;<span class="string">&#x27;definition&#x27;</span>: <span class="string">&quot;a long piece of hair that is added to a person&#x27;s own hair in order to make the hair longer&quot;</span>,   </span><br><span class="line"><span class="string">&#x27;translation&#x27;</span>: <span class="string">&#x27;（為創造長髮效果而織入頭髮的）一段假髮&#x27;</span>,  </span><br><span class="line"> <span class="string">&#x27;examples&#x27;</span>: []&#125;,  </span><br><span class="line"> &#123;<span class="string">&#x27;definition&#x27;</span>: <span class="string">&#x27;a new part added to a house or other building&#x27;</span>,   </span><br><span class="line"><span class="string">&#x27;translation&#x27;</span>: <span class="string">&#x27;擴建部分&#x27;</span>,   </span><br><span class="line"><span class="string">&#x27;examples&#x27;</span>: [(<span class="string">&quot;We&#x27;re building an extension to/on our house.&quot;</span>, <span class="string">&#x27;我們正在對房屋進行擴建。&#x27;</span>)]&#125;,   </span><br><span class="line">&#123;<span class="string">&#x27;definition&#x27;</span>: <span class="string">&quot;intended to support students&#x27; learning by making them try different or more difficult things in addition to their basic work&quot;</span>,   </span><br><span class="line"><span class="string">&#x27;translation&#x27;</span>: <span class="string">&#x27;（學生作業）延展性的，難度更高的，範圍更廣的&#x27;</span>,  </span><br><span class="line"> <span class="string">&#x27;examples&#x27;</span>: [(<span class="string">&#x27;The book includes lesson plans and extension activities.&#x27;</span>, <span class="string">&#x27;這本書包括課堂計畫和延展性活動。&#x27;</span>)]&#125;,  </span><br><span class="line"> &#123;<span class="string">&#x27;definition&#x27;</span>: <span class="string">&#x27;offered by a university to people who are not studying for a degree there&#x27;</span>,   </span><br><span class="line"><span class="string">&#x27;translation&#x27;</span>: <span class="string">&#x27;（尤指學院或大學）對校外學生提供課程的；為非在校生而設的&#x27;</span>,   </span><br><span class="line"><span class="string">&#x27;examples&#x27;</span>: [(<span class="string">&#x27;extension classes/courses&#x27;</span>, <span class="string">&#x27;對校外學生開設的課程&#x27;</span>)]&#125;]</span><br></pre></td></tr></table></figure>


<h1 id="總結"><a href="#總結" class="headerlink" title="總結"></a>總結</h1><p>這個部分是總結了我再取得有效英文單字資料的過程，包含如何爬蟲，以及優化爬蟲結果及例外處理，為了更有效的去接notion的資料，也做了許多優化，之後遇到類似結構的網站，都能套用同一個邏輯去分析。</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2023/Use-Notion-and-Python-to-build-my-own-vocabulary-database-%E2%80%94-1-Introduction/">Use Notion and Python to build my own vocabulary database — (1)[Introduction]</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2023-06-30</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/python/">python</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/notion/">notion</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/crawler/">crawler</a></span><div class="content"><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>在學習英語的過程中，Notion 一直是我的得力助手，我習慣在其中記錄自己遇到的新單字並進行筆記。在採納了一些推薦後，我開始使用劍橋英文翻譯網站來查詢陌生的單詞，並將其整理到 Notion 的單詞庫中。經過一段時間的實踐，我們發現這種方法相當繁瑣。首先，需要開啟多個網站；其次，每次都需要手動創建新的頁面，輸入單詞，然後將其整理到 Notion 中。因此，在注意到 Notion 推出其 API 系統的時機，我們決定開發一個能自動化這些繁瑣步驟的專案，用於建立英文筆記的資料庫，當然熟悉過後，也能用來整合自己的其他筆記源。</p>
<h1 id="預期結果"><a href="#預期結果" class="headerlink" title="預期結果"></a>預期結果</h1><p><img src="/images/pasted-0.png" alt="Fig1:How does the database look like"></p>
<p><img src="/images/pasted-1.png" alt="fig2:How does the page look like"></p>
<h1 id="如何達成"><a href="#如何達成" class="headerlink" title="如何達成"></a>如何達成</h1><p>為了達成目的，我整理了一些必需解決的問題</p>
<p>如何取得有效的英文單字資料源<br>如何使用Notion API更新資料庫<br>如何將取得的資料處理過後用有效的方法輸入至資料庫中<br>更方便的使用模式（chrome extension的使用）<br>在這個系列文中，我將會一步一步介紹我是如何解決上面得目標，以及如何去解決遇到的問題以及我的思路。</p>
<p>專案連結：yamaallen&#x2F;vocabulary_database (github.com)</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2023/hello-world/">Hello World</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2023-06-30</time><div class="content"><p>Welcome to <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a target="_blank" rel="noopener" href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a target="_blank" rel="noopener" href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a target="_blank" rel="noopener" href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>
</div><hr></div><nav id="pagination"><div class="pagination"><span class="page-number current">1</span></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2023 By Shan Chi Wang (Allen)</div><div class="framework-info"><span>Driven - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_site_uv"><i class="fa fa-user"></i><span id="busuanzi_value_site_uv"></span><span></span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_site_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/lib/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.1"></script><script src="/js/fancybox.js?version=1.9.1"></script><script src="/js/sidebar.js?version=1.9.1"></script><script src="/js/copy.js?version=1.9.1"></script><script src="/js/fireworks.js?version=1.9.1"></script><script src="/js/transition.js?version=1.9.1"></script><script src="/js/scroll.js?version=1.9.1"></script><script src="/js/head.js?version=1.9.1"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>